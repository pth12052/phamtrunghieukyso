<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NgÆ°á»i gá»­i</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
<div class="container">
    <h1>NgÆ°á»i Gá»­i: Truyá»n File CÃ³ KÃ½ Sá»‘</h1>

    <form method="POST" action="/upload" enctype="multipart/form-data" id="upload-form">
        <div id="drop-area">
            <p>KÃ©o tháº£ file hoáº·c nháº¥n Ä‘á»ƒ chá»n</p>
            <input type="file" name="file" id="fileElem" required>
        </div>
        <div id="file-name"></div>
        <button type="submit">Táº£i lÃªn & KÃ½ sá»‘</button>
    </form>

    {% if signature %}
    <div class="result">
        <h2>Chá»¯ kÃ½:</h2>
        <textarea rows="6" readonly id="signature">{{ signature }}</textarea>

        <h2>Public Key:</h2>
        <textarea rows="10" readonly id="pubkey">{{ pub_key }}</textarea>

        <h2>Dá»¯ liá»‡u Ä‘Ã£ kÃ½:</h2>
        <textarea rows="6" readonly id="signed-data">{{ file_data }}</textarea>
    </div>
    {% endif %}
</div>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script>
    const dropArea = document.getElementById('drop-area');
    const fileInput = document.getElementById('fileElem');
    const fileNameDisplay = document.getElementById('file-name');

    dropArea.addEventListener('click', () => fileInput.click());
    dropArea.addEventListener('dragover', e => {
        e.preventDefault();
        dropArea.classList.add('highlight');
    });
    dropArea.addEventListener('dragleave', () => dropArea.classList.remove('highlight'));
    dropArea.addEventListener('drop', e => {
        e.preventDefault();
        dropArea.classList.remove('highlight');
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            fileInput.files = files;
            fileNameDisplay.innerHTML = `ğŸ“„ File Ä‘Ã£ chá»n: <strong>${files[0].name}</strong>`;
        }
    });

    fileInput.addEventListener('change', () => {
        if (fileInput.files.length > 0) {
            fileNameDisplay.innerHTML = `ğŸ“„ File Ä‘Ã£ chá»n: <strong>${fileInput.files[0].name}</strong>`;
        }
    });

    const socket = io();
    const sendBtn = document.getElementById('send-to-receiver');
    if (sendBtn) {
        sendBtn.addEventListener('click', () => {
            const signature = document.getElementById('signature').value;
            const pub_key = document.getElementById('pubkey').value;
            const data = document.getElementById('signed-data').value;

            socket.emit('new_signature', {
                signature: signature,
                pub_key: pub_key,
                data: data
            });

            alert("âœ… ÄÃ£ gá»­i dá»¯ liá»‡u kÃ½ sá»‘ Ä‘áº¿n ngÆ°á»i nháº­n!");
        });
    }
</script>
</body>
</html>
